<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aurelius</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial,sans-serif;background:#fff;color:#111;max-width:700px;margin:40px auto;padding:20px}h1{font-size:2em;margin-bottom:20px}#search{width:100%;padding:10px;margin-bottom:10px;border:1px solid #ddd;border-radius:4px;font-size:1em}.toolbar{display:flex;gap:10px;margin-bottom:20px}#search{flex:1}button{padding:8px 12px;background:#f0f0f0;border:1px solid #ddd;border-radius:4px;cursor:pointer;font-size:1em}button:hover{background:#e0e0e0}#content{margin:20px 0}details{margin:15px 0;padding:10px;background:#f9f9f9;border-radius:4px}details[open]{background:#f0f0f0}summary{cursor:pointer;font-weight:bold;user-select:none}summary:hover{color:#0066cc}summary span{margin-right:10px}summary .count{color:#888;font-weight:normal}a{display:block;padding:8px 0;color:#0066cc;text-decoration:none;border-bottom:1px solid #eee}a:hover{color:#0052a3;text-decoration:underline}a.hidden{display:none}#update-time{margin-top:20px;padding-top:20px;border-top:1px solid #ddd;color:#666;font-size:0.9em;text-align:center}body.dark{background:#1e1e1e;color:#e0e0e0}body.dark #search{background:#333;color:#e0e0e0;border-color:#555}body.dark button{background:#333;border-color:#555;color:#e0e0e0}body.dark button:hover{background:#444}body.dark details{background:#2a2a2a}body.dark details[open]{background:#333}body.dark summary{color:#e0e0e0}body.dark a{color:#4da6ff;border-color:#444}body.dark a:hover{color:#80c3ff}body.dark #update-time{border-color:#444;color:#aaa}
</style>
</head>
<body>

<h1>Aurelius</h1>

<div class="toolbar">
  <input type="text" id="search" placeholder="æœç´¢åç§°ã€URLã€æ ‡ç­¾æˆ–åˆ†ç±»...">
  <button id="theme-btn" title="åˆ‡æ¢æ·±è‰²æ¨¡å¼">ğŸŒ™</button>
  <button id="export-btn" title="å¯¼å‡ºä¸º JSON">â¬‡ï¸</button>
  <button id="import-btn" title="å¯¼å…¥ JSON">â¬†ï¸</button>
</div>

<input type="file" id="file-input" accept=".json" style="display:none">

<div id="content"></div>

<div id="update-time">åŠ è½½ä¸­...</div>

<script>
const d = document;
const s = d.getElementById('search');
const c = d.getElementById('content');
const u = d.getElementById('update-time');
const themeBtn = d.getElementById('theme-btn');
const exportBtn = d.getElementById('export-btn');
const importBtn = d.getElementById('import-btn');
const fileInput = d.getElementById('file-input');

let siteGroups = [];

// ä¸»é¢˜åˆ‡æ¢
function initTheme() {
  const saved = localStorage.getItem('theme') === 'dark';
  if (saved) d.body.classList.add('dark');
  updateThemeBtn();
}

function toggleTheme() {
  d.body.classList.toggle('dark');
  const isDark = d.body.classList.contains('dark');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  updateThemeBtn();
}

function updateThemeBtn() {
  themeBtn.textContent = d.body.classList.contains('dark') ? 'â˜€ï¸' : 'ğŸŒ™';
}

// åˆ›å»ºé“¾æ¥å…ƒç´ 
function createLink(link) {
  const a = d.createElement('a');
  a.href = link.url;
  a.target = '_blank';
  a.rel = 'noopener noreferrer';
  a.textContent = link.title;
  a.dataset.title = link.title.toLowerCase();
  a.dataset.url = link.url.toLowerCase();
  a.dataset.tags = (link.tags || '').toLowerCase();
  if (link.tags && link.tags.trim()) a.title = link.tags;
  return a;
}

// æ¸²æŸ“ç½‘ç«™
function render() {
  c.innerHTML = '';
  siteGroups.forEach(g => {
    const sec = d.createElement('details');
    sec.dataset.category = g.category.toLowerCase();
    const sum = d.createElement('summary');
    sum.innerHTML = `<span>${g.category}</span><span class="count">(${g.links.length})</span>`;
    sec.appendChild(sum);
    g.links.forEach(l => sec.appendChild(createLink(l)));
    c.appendChild(sec);
  });
}

// æœç´¢è¿‡æ»¤
function filter() {
  const q = s.value.toLowerCase().trim();
  d.querySelectorAll('#content details').forEach(sec => {
    let show = false;
    sec.querySelectorAll('a').forEach(a => {
      const match = !q || a.dataset.title.includes(q) || a.dataset.url.includes(q) || a.dataset.tags.includes(q) || sec.dataset.category.includes(q);
      a.classList.toggle('hidden', !match);
      if (match) show = true;
    });
    sec.classList.toggle('hidden', !show);
  });
}

// è·å–æœ€åæ›´æ–°æ—¶é—´
function updateTime() {
  fetch('https://api.github.com/repos/AureliusWu/AureliusWu.github.io/commits?per_page=1')
    .then(response => {
      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
      return response.json();
    })
    .then(data => {
      if (!data || data.length === 0) throw new Error('No commits found');
      const lastCommitDate = new Date(data[0].commit.author.date);
      const formattedDate = lastCommitDate.toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
      u.textContent = `æœ¬é¡µé¢æœ€åæ›´æ–°æ—¶é—´ï¼š${formattedDate}`;
    })
    .catch(error => {
      console.error('è·å–æ›´æ–°æ—¶é—´å¤±è´¥:', error);
      u.textContent = 'æœ¬é¡µé¢æœ€åæ›´æ–°æ—¶é—´ï¼šè·å–å¤±è´¥';
    });
}

// å¯¼å‡º
function exportData() {
  const json = JSON.stringify(siteGroups, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = d.createElement('a');
  a.href = url;
  a.download = `bookmarks-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

// å¯¼å…¥
function importData() {
  fileInput.click();
}

fileInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (evt) => {
    try {
      siteGroups = JSON.parse(evt.target.result);
      render();
      updateTime();
      alert('å¯¼å…¥æˆåŠŸï¼');
    } catch (err) {
      alert('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
    }
  };
  reader.readAsText(file);
});

// åˆå§‹åŒ–
async function init() {
  try {
    const res = await fetch('data.json');
    siteGroups = await res.json();
  } catch (e) {
    console.warn('æ— æ³•åŠ è½½ data.jsonï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
    siteGroups = [];
  }
  
  initTheme();
  render();
  updateTime();
  
  s.addEventListener('input', filter);
  themeBtn.addEventListener('click', toggleTheme);
  exportBtn.addEventListener('click', exportData);
  importBtn.addEventListener('click', importData);
  s.focus();
  
  setInterval(updateTime, 60000); // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡æ—¶é—´
}

d.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>