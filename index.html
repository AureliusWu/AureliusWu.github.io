<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aurelius</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial,sans-serif;background:#fff;color:#111;max-width:700px;margin:40px auto;padding-bottom:80px;transition:background .3s,color .3s}body.dark{background:#1a1a1a;color:#e4e4e4}h1{font-weight:500;margin-bottom:20px}input{width:100%;padding:10px;margin-bottom:30px;font-size:14px;border:1px solid #eee;border-radius:4px;background:#fff;color:#111;transition:border-color .3s}body.dark input{background:#2a2a2a;color:#e4e4e4;border-color:#444}.toolbar{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}button{padding:8px 12px;border:1px solid #eee;background:#fff;color:#111;cursor:pointer;border-radius:4px;font-size:13px;transition:all .3s}button:hover{background:#f5f5f5;border-color:#ccc}body.dark button{background:#2a2a2a;color:#e4e4e4;border-color:#444}body.dark button:hover{background:#333}details{margin-bottom:15px;border-radius:4px;overflow:hidden}details[open]{box-shadow:0 2px 8px rgba(0,0,0,.1)}body.dark details[open]{box-shadow:0 2px 8px rgba(0,0,0,.3)}summary{cursor:pointer;font-size:16px;padding:10px;border-bottom:1px solid #eee;background:#f9f9f9;user-select:none;display:flex;justify-content:space-between;align-items:center}body.dark summary{background:#222;border-bottom-color:#444}summary:hover{background:#f0f0f0}body.dark summary:hover{background:#2a2a2a}a{display:block;text-decoration:none;color:#0066cc;margin:8px 0 8px 15px;font-size:14px;position:relative;word-break:break-all;transition:color .2s}a:hover{color:#0052a3}body.dark a{color:#4da6ff}body.dark a:hover{color:#66b3ff}.hidden{display:none}.count{font-size:13px;opacity:.6;margin-left:6px}#update-time{text-align:center;font-size:13px;color:#666;margin-top:40px;opacity:.8}body.dark #update-time{color:#999}a[title]:hover::after{content:attr(title);position:absolute;left:0;top:calc(100% + 10px);background:#333;color:#fff;padding:6px 10px;border-radius:4px;font-size:12px;white-space:nowrap;z-index:10;pointer-events:none;box-shadow:0 2px 8px rgba(0,0,0,.3)}a[title]:hover::before{content:"";position:absolute;left:10px;top:calc(100% + 4px);border:6px solid transparent;border-bottom-color:#333;z-index:10
</style>
</head>
<body>

<h1>Aurelius</h1>

<div class="toolbar">
  <input type="text" id="search" placeholder="æœç´¢åç§°ã€URLã€æ ‡ç­¾æˆ–åˆ†ç±»...">
  <button id="theme-btn" title="åˆ‡æ¢æ·±è‰²æ¨¡å¼">ğŸŒ™</button>
  <button id="export-btn" title="å¯¼å‡ºä¸º JSON">â¬‡ï¸</button>
  <button id="import-btn" title="å¯¼å…¥ JSON">â¬†ï¸</button>
</div>

<input type="file" id="file-input" accept=".json" style="display:none">

<div id="content"></div>

<div id="update-time">åŠ è½½ä¸­...</div>

<script>
const d = document;
const s = d.getElementById('search');
const c = d.getElementById('content');
const u = d.getElementById('update-time');
const themeBtn = d.getElementById('theme-btn');
const exportBtn = d.getElementById('export-btn');
const importBtn = d.getElementById('import-btn');
const fileInput = d.getElementById('file-input');

let siteGroups = [];

// ä¸»é¢˜åˆ‡æ¢
function initTheme() {
  const saved = localStorage.getItem('theme') === 'dark';
  if (saved) d.body.classList.add('dark');
  updateThemeBtn();
}

function toggleTheme() {
  d.body.classList.toggle('dark');
  const isDark = d.body.classList.contains('dark');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
  updateThemeBtn();
}

function updateThemeBtn() {
  themeBtn.textContent = d.body.classList.contains('dark') ? 'â˜€ï¸' : 'ğŸŒ™';
}

// åˆ›å»ºé“¾æ¥å…ƒç´ 
function createLink(link) {
  const a = d.createElement('a');
  a.href = link.url;
  a.target = '_blank';
  a.rel = 'noopener noreferrer';
  a.textContent = link.title;
  a.dataset.title = link.title.toLowerCase();
  a.dataset.url = link.url.toLowerCase();
  a.dataset.tags = (link.tags || '').toLowerCase();
  if (link.tags && link.tags.trim()) a.title = link.tags;
  return a;
}

// æ¸²æŸ“ç½‘ç«™
function render() {
  c.innerHTML = '';
  siteGroups.forEach(g => {
    const sec = d.createElement('details');
    sec.dataset.category = g.category.toLowerCase();
    const sum = d.createElement('summary');
    sum.innerHTML = `<span>${g.category}</span><span class="count">(${g.links.length})</span>`;
    sec.appendChild(sum);
    g.links.forEach(l => sec.appendChild(createLink(l)));
    c.appendChild(sec);
  });
}

// æœç´¢è¿‡æ»¤
function filter() {
  const q = s.value.toLowerCase().trim();
  d.querySelectorAll('#content details').forEach(sec => {
    let show = false;
    sec.querySelectorAll('a').forEach(a => {
      const match = !q || a.dataset.title.includes(q) || a.dataset.url.includes(q) || a.dataset.tags.includes(q) || sec.dataset.category.includes(q);
      a.classList.toggle('hidden', !match);
      if (match) show = true;
    });
    sec.classList.toggle('hidden', !show);
  });
}

<script>
  // ä» GitHub API è·å–ä»“åº“æœ€åæäº¤æ—¶é—´
  fetch('https://api.github.com/repos/AureliusWu/AureliusWu.github.io/commits?per_page=1')
    .then(response => response.json())
    .then(data => {
      const lastCommitDate = new Date(data[0].commit.author.date);
      const formattedDate = lastCommitDate.toLocaleString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
      document.getElementById('last-updated').textContent = `æœ¬é¡µé¢æœ€åæ›´æ–°æ—¶é—´ï¼š${formattedDate}`;
    })
    .catch(error => {
      console.error('è·å–æ›´æ–°æ—¶é—´å¤±è´¥:', error);
      document.getElementById('last-updated').textContent = 'æœ¬é¡µé¢æœ€åæ›´æ–°æ—¶é—´ï¼šè·å–å¤±è´¥';
    });
</script>

<!-- åœ¨é¡µé¢ä¸­æ˜¾ç¤ºæ—¶é—´çš„ä½ç½® -->
<p id="last-updated">æ­£åœ¨åŠ è½½æ›´æ–°æ—¶é—´...</p>

// å¯¼å‡º
function exportData() {
  const json = JSON.stringify(siteGroups, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = d.createElement('a');
  a.href = url;
  a.download = `bookmarks-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

// å¯¼å…¥
function importData() {
  fileInput.click();
}

fileInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (evt) => {
    try {
      siteGroups = JSON.parse(evt.target.result);
      render();
      updateTime();
      alert('å¯¼å…¥æˆåŠŸï¼');
    } catch (err) {
      alert('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
    }
  };
  reader.readAsText(file);
});

// åˆå§‹åŒ–
async function init() {
  try {
    const res = await fetch('data.json');
    siteGroups = await res.json();
  } catch (e) {
    console.warn('æ— æ³•åŠ è½½ data.jsonï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
    siteGroups = [];
  }
  
  initTheme();
  render();
  updateTime();
  
  s.addEventListener('input', filter);
  themeBtn.addEventListener('click', toggleTheme);
  exportBtn.addEventListener('click', exportData);
  importBtn.addEventListener('click', importData);
  s.focus();
  
  setInterval(updateTime, 60000); // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡æ—¶é—´
}

d.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
